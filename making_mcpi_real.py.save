import mcpi.minecraft as minecraft
from time import sleep
from _classes import *
from keyboard import on_release_key

game = minecraft.Minecraft.create()

# Recognize first player to join as admin
admin: Player = Player(game.getPlayerEntityIds()[0], sword_type="netherite", sword_enchantments={
    "sharpness": 5, "fire_aspect": 2}, is_admin=True)
i = 1

game.player.setting("autojump", False)

on_release_key()

# If run with pythonw
try:
    if i == 1: print("Started mod")  # Only runs on first iteration
except:
    pass

while True:
    # Recognizing players
    for player in game.getPlayerEntityIds():
        Player(player)

    events = game.events.pollBlockHits()

    for event in events:
        if game.getBlock(event.pos) == 46:  # TNT
            game.setBlock(event.pos, 46, 1)  # Primeable TNT
        elif game.getBlock(event.pos) == 22:  # Lapis
            game.setBlock(event.pos, 8)  # Flowing water
        elif game.getBlockWithData(event.pos).id == 35 and game.getBlockWithData(event.pos).data == 1:  # Orange wool
            game.setBlock(event.pos, 10)  # Flowing lava
        # Setting spawnpoint using bed
        elif game.getBlock(event.pos) == 26:
            open("rspnpt.dat", 'w').write(str(event.pos))
            game.postToChat("Respawn point set")
        # Write about how the world is right now
        elif game.getBlock(event.pos) == 47:  # Bookshelf
            game.saveCheckpoint()
            game.postToChat("Restore point set")
        # Go back to the written memories
        elif game.getBlock(event.pos) == 247 and (  # Nether Reactor Core
                game.getBlock(event.pos.x - 1, event.pos.y, event.pos.z) == 47  # Bookshelf anywhere around it
                    or game.getBlock(event.pos.x - 1, event.pos.y, event.pos.z) == 47
                    or game.getBlock(event.pos.x + 1, event.pos.y, event.pos.z) == 47
                    or game.getBlock(event.pos.x, event.pos.y, event.pos.z - 1) == 47
                    or game.getBlock(event.pos.x, event.pos.y, event.pos.z + 1) == 47
                    or game.getBlock(event.pos.x, event.pos.y - 1, event.pos.z) == 47
                    or game.getBlock(event.pos.x, event.pos.y + 1, event.pos.z) == 47):
            game.restoreCheckpoint()
            game.postToChat("Restoration complete")
        # Chests
        # Prevents lag, VERY slow fps
        sleep(1)
